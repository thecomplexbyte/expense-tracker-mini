services:
  app:
    build:
      context: .
      dockerfile: docker/app/Dockerfile
    ports:
      - "8000:8000"
    volumes:
      - .:/app
    user: "${UID:-1000}:${GID:-1000}"
    environment:
      APP_ENV: dev
      HOME: /tmp

  node:
    image: node:20-alpine
    working_dir: /app
    ports:
      - "5173:5173"
    volumes:
      - .:/app
      - pnpm-store:/pnpm-store
    environment:
      PNPM_STORE_DIR: /pnpm-store
      COREPACK_ENABLE_STRICT: 0
    command: >
      sh -c "
        corepack enable &&
        corepack prepare pnpm@9.15.4 --activate &&
        pnpm install &&
        pnpm dev --host 0.0.0.0 --port 5173
      "

volumes:
  pnpm-store:
